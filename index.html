<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LatteTyper | v0.5 Engine</title>
    <style>
        :root {
            --espresso: #3d2622;
            --latte: #f5ebe0;
            --accent: #d4a373;
            --danger: #e63946;
            --success: #52b788;
            --bg-speed: 60s;
        }

        /* --- INFINITE BACKGROUND --- */
        body {
            margin: 0; padding: 0;
            background-color: var(--latte);
            font-family: 'Courier New', Courier, monospace;
            height: 100vh; display: flex;
            align-items: center; justify-content: center;
            overflow: hidden;
        }

        body::before {
            content: "";
            position: fixed; top: 0; left: 0;
            width: 200%; height: 100%;
            background: url('https://www.transparenttextures.com/patterns/coffee-beans-with-glaze.png');
            opacity: 0.15;
            z-index: -1;
            animation: scrollBg var(--bg-speed) linear infinite;
        }

        @keyframes scrollBg {
            from { transform: translateX(0); }
            to { transform: translateX(-50%); }
        }

        /* --- LOADING SCREEN --- */
        #loader {
            position: fixed; inset: 0; background: var(--espresso);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 100; color: white; transition: opacity 1s ease;
        }

        .load-bar {
            width: 250px; height: 4px; background: #555;
            margin-top: 20px; border-radius: 2px; overflow: hidden;
        }

        #load-fill {
            width: 0%; height: 100%; background: var(--accent);
            transition: width 5s linear;
        }

        /* --- GAME UI --- */
        #game-screen {
            display: none; width: 90%; max-width: 700px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(15px);
            padding: 40px; border-radius: 25px;
            box-shadow: 20px 20px 0px var(--accent);
            position: relative;
        }

        #version-tag { position: absolute; bottom: 10px; right: 15px; font-size: 10px; color: #b0a496; font-weight: bold; }

        #order-box {
            font-size: 20px; color: var(--espresso); margin-bottom: 20px;
            min-height: 80px; padding: 20px; border-left: 5px solid var(--accent);
            background: rgba(255, 255, 255, 0.5); transition: 0.3s;
        }

        .blur { filter: blur(8px); opacity: 0.3; }

        #input-area {
            width: 100%; border: none; border-bottom: 3px solid var(--espresso);
            font-size: 24px; padding: 10px 0; outline: none; background: transparent;
        }

        .stats { display: flex; justify-content: space-between; font-weight: bold; margin-bottom: 15px; }

        #heat-fill { height: 10px; background: var(--success); width: 100%; transition: 0.1s linear; border-radius: 5px; }

        #game-over {
            display: none; position: absolute; inset: 0;
            background: rgba(61, 38, 34, 0.98); border-radius: 25px;
            flex-direction: column; align-items: center; justify-content: center; color: white;
            z-index: 10; text-align: center;
        }

        button { background: var(--accent); color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>

    <div id="loader">
        <h2 style="letter-spacing: 5px;">LATTETYPER</h2>
        <div class="load-bar"><div id="load-fill"></div></div>
        <p id="load-text" style="font-size: 12px; margin-top: 10px;">Pre-heating espresso machine...</p>
    </div>

    <div id="game-screen">
        <div id="version-tag">VER_0.5_STABLE</div>
        <div id="game-over">
            <h1>â˜• SHIFT ENDED</h1>
            <p id="final-stats"></p>
            <button onclick="location.reload()">Restart</button>
        </div>

        <div class="stats">
            <span>WPM: <span id="wpm">0</span></span>
            <span>HEAT: <span id="heat-val">100</span>%</span>
        </div>

        <div id="order-box">Press any key to start your shift...</div>
        <input type="text" id="input-area" placeholder="Type here..." autocomplete="off">
        
        <div style="width: 100%; background: #eee; border-radius: 5px; margin-top: 20px;">
            <div id="heat-fill"></div>
        </div>
    </div>

    <script>
        // --- LOADING SEQUENCE ---
        window.onload = () => {
            const fill = document.getElementById('load-fill');
            fill.style.width = "100%";
            setTimeout(() => {
                document.getElementById('loader').style.opacity = "0";
                setTimeout(() => {
                    document.getElementById('loader').style.display = "none";
                    document.getElementById('game-screen').style.display = "block";
                }, 1000);
            }, 5000);
        };

        const orders = [
            "Triple-shot espresso, no sugar, extra foam.",
            "I'll have a tall oat milk latte with two pumps of vanilla.",
            "Can I get a large Iced Americano with 2% milk?",
            "Soy milk latte with two pumps of hazelnut syrup.",
            "Flat white with a dash of cinnamon on top please.",
            "The #DailySpecial with @extra_shots pronto!"
        ];

        let currentOrder = "", gameActive = false, heat = 100, totalChars = 0, startTime;
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        function playSound(freq, duration) {
            if(audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            gain.gain.setValueAtTime(0.02, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + duration);
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.start(); osc.stop(audioCtx.currentTime + duration);
        }

        function startGame() {
            gameActive = true;
            startTime = new Date();
            nextOrder();
            startHeatMeter();
        }

        function nextOrder() {
            const box = document.getElementById('order-box');
            box.classList.add('blur');
            setTimeout(() => {
                currentOrder = orders[Math.floor(Math.random() * orders.length)];
                box.innerText = currentOrder;
                box.classList.remove('blur');
                document.getElementById('input-area').value = "";
            }, 250);
        }

        document.getElementById('input-area').addEventListener('input', (e) => {
            if(!gameActive) startGame();
            playSound(200 + Math.random() * 100, 0.05);

            const val = e.target.value;
            const timeElapsedMin = (new Date() - startTime) / 60000;
            
            if (timeElapsedMin > 0.03) {
                const wpm = Math.round(((totalChars + val.length) / 5) / timeElapsedMin);
                document.getElementById('wpm').innerText = wpm;
                
                // SPEED SYNC: Background moves faster as WPM increases
                const newSpeed = Math.max(5, 60 - (wpm / 2));
                document.body.style.setProperty('--bg-speed', `${newSpeed}s`);
            }

            if(val === currentOrder) {
                playSound(880, 0.3);
                totalChars += currentOrder.length;
                heat = Math.min(100, heat + 20);
                nextOrder();
            }
        });

        function startHeatMeter() {
            setInterval(() => {
                if(!gameActive) return;
                heat -= 0.4;
                document.getElementById('heat-fill').style.width = heat + "%";
                document.getElementById('heat-val').innerText = Math.floor(heat);
                if(heat <= 0) endGame();
            }, 100);
        }

        function endGame() {
            gameActive = false;
            document.getElementById('final-stats').innerText = `Speed: ${document.getElementById('wpm').innerText} WPM`;
            document.getElementById('game-over').style.display = 'flex';
        }
    </script>
</body>
</html>
