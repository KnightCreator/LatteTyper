<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LatteTyper | v0.6</title>
    <style>
        :root {
            --espresso: #3d2622;
            --latte: #f5ebe0;
            --accent: #d4a373;
            --danger: #e63946;
            --success: #52b788;
            --choco: #7b3f00;
        }

        /* --- 45 DEGREE INFINITE BACKGROUND --- */
        body {
            margin: 0; padding: 0;
            background-color: var(--latte);
            font-family: 'Courier New', Courier, monospace;
            height: 100vh; display: flex;
            align-items: center; justify-content: center;
            overflow: hidden;
        }

        body::before {
            content: "";
            position: fixed; inset: 0;
            background: repeating-linear-gradient(
                45deg,
                rgba(61, 38, 34, 0.05),
                rgba(61, 38, 34, 0.05) 10px,
                rgba(245, 235, 224, 0) 10px,
                rgba(245, 235, 224, 0) 20px
            );
            z-index: -1;
            animation: moveBg 10s linear infinite;
        }

        @keyframes moveBg {
            from { background-position: 0 0; }
            to { background-position: 100px 0; }
        }

        /* --- LOADER --- */
        #loader {
            position: fixed; inset: 0; background: var(--espresso);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 100; color: white;
        }

        .load-bar { width: 200px; height: 4px; background: #444; margin-top: 15px; border-radius: 2px; overflow: hidden; }
        #load-fill { width: 0%; height: 100%; background: var(--accent); transition: width 5s linear; }

        /* --- MODE SELECTION --- */
        #mode-menu {
            display: none; text-align: center; background: white; 
            padding: 40px; border-radius: 20px; box-shadow: 10px 10px 0px var(--espresso);
        }

        /* --- GAME UI --- */
        #game-screen {
            display: none; width: 90%; max-width: 650px;
            background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px);
            padding: 30px; border-radius: 20px; box-shadow: 15px 15px 0px var(--accent);
            position: relative;
        }

        #order-box { font-size: 20px; padding: 20px; border-left: 5px solid var(--accent); background: #faf9f6; margin: 15px 0; }
        #input-area { width: 100%; border: none; border-bottom: 2px solid var(--espresso); font-size: 22px; padding: 10px 0; outline: none; background: transparent; }
        
        /* --- CHOCOLATE PROGRESS BAR --- */
        #choco-container { width: 100%; height: 20px; background: #eee; margin-top: 10px; border-radius: 4px; position: relative; overflow: hidden; }
        #choco-fill { height: 100%; width: 0%; background: var(--choco); transition: width 0.2s; }

        .stats { display: flex; justify-content: space-between; font-weight: bold; font-size: 14px; }
        #game-over { display: none; position: absolute; inset: 0; background: var(--espresso); color: white; flex-direction: column; align-items: center; justify-content: center; border-radius: 20px; z-index: 50; }

        button { background: var(--espresso); color: white; border: none; padding: 12px 24px; cursor: pointer; border-radius: 4px; font-family: inherit; margin: 5px; }
        button:hover { background: var(--accent); }
    </style>
</head>
<body>

    <div id="loader">
        <h2>HEATING...</h2>
        <div class="load-bar"><div id="load-fill"></div></div>
    </div>

    <div id="mode-menu">
        <h1 style="color: var(--espresso);">LatteTyper</h1>
        <p>Select your shift difficulty:</p>
        <button onclick="initGame('normal')">Cozy (Normal)</button>
        <button onclick="initGame('hard')" style="background: var(--danger);">Rush Hour (Hard)</button>
    </div>

    <div id="game-screen">
        <div id="game-over">
            <h1>â˜• RESULTS</h1>
            <p id="final-stats"></p>
            <div>
                <button onclick="location.reload()">Menu</button>
                <button id="share-btn">Share Challenge</button>
            </div>
        </div>

        <div class="stats">
            <span>WPM: <span id="wpm-val">0</span></span>
            <span>TOP: <span id="top-val">0</span></span>
        </div>

        <div id="order-box">Wait for order...</div>
        <input type="text" id="input-area" placeholder="Type here..." autocomplete="off">
        
        <p style="font-size: 10px; margin-top: 20px; font-weight: bold;">ORDER PROGRESSION (CHOCOLATE BAR)</p>
        <div id="choco-container"><div id="choco-fill"></div></div>
    </div>

    <script>
        let currentOrder = "", gameActive = false, totalChars = 0, startTime, mode = 'normal';
        let scores = JSON.parse(localStorage.getItem('cafeScores')) || [];

        // --- ONE-TIME LOADING LOGIC ---
        window.onload = () => {
            if (sessionStorage.getItem('hasLoaded')) {
                document.getElementById('loader').style.display = 'none';
                document.getElementById('mode-menu').style.display = 'block';
            } else {
                document.getElementById('load-fill').style.width = '100%';
                setTimeout(() => {
                    sessionStorage.setItem('hasLoaded', 'true');
                    document.getElementById('loader').style.opacity = '0';
                    setTimeout(() => {
                        document.getElementById('loader').style.display = 'none';
                        document.getElementById('mode-menu').style.display = 'block';
                    }, 500);
                }, 5000);
            }
            document.getElementById('top-val').innerText = scores.length > 0 ? scores[0] : 0;
        };

        function initGame(m) {
            mode = m;
            document.getElementById('mode-menu').style.display = 'none';
            document.getElementById('game-screen').style.display = 'block';
            document.getElementById('input-area').focus();
            nextOrder();
        }

        function nextOrder() {
            const list = ["Hot latte, no sugar.", "Iced Americano.", "Espresso shot.", "Oat milk flat white.", "Caramel Macchiato."];
            currentOrder = list[Math.floor(Math.random() * list.length)];
            document.getElementById('order-box').innerText = currentOrder;
            document.getElementById('input-area').value = "";
            document.getElementById('choco-fill').style.width = "0%";
            if(!gameActive) { gameActive = true; startTime = new Date(); }
        }

        document.getElementById('input-area').addEventListener('input', (e) => {
            const val = e.target.value;
            
            // Progress Logic (Chocolate Bar)
            const progress = (val.length / currentOrder.length) * 100;
            document.getElementById('choco-fill').style.width = Math.min(progress, 100) + "%";

            // Live WPM
            const timeElapsed = (new Date() - startTime) / 60000;
            if (timeElapsed > 0.01) {
                const wpm = Math.round(((totalChars + val.length) / 5) / timeElapsed);
                document.getElementById('wpm-val').innerText = wpm;
            }

            if (val === currentOrder) {
                totalChars += currentOrder.length;
                nextOrder();
            }

            // Hard Mode Penalty: Too many mistakes = instant lose
            if(mode === 'hard' && val.length > 0 && val[val.length-1] !== currentOrder[val.length-1]) {
                endGame("TYPO DETECTED!");
            }
        });

        function endGame(reason) {
            gameActive = false;
            const finalWpm = document.getElementById('wpm-val').innerText;
            scores.push(parseInt(finalWpm));
            scores.sort((a,b) => b-a);
            localStorage.setItem('cafeScores', JSON.stringify(scores.slice(0, 5)));
            
            document.getElementById('final-stats').innerText = `${reason}\nScore: ${finalWpm} WPM`;
            document.getElementById('game-over').style.display = 'flex';

            document.getElementById('share-btn').onclick = () => {
                const url = window.location.origin + window.location.pathname + `?challenge=${finalWpm}`;
                navigator.clipboard.writeText(url);
                alert("Challenge copied!");
            };
        }
    </script>
</body>
</html>
